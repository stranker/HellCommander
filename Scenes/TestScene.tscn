[gd_scene load_steps=3 format=2]

[ext_resource path="res://icon.png" type="Texture" id=1]

[sub_resource type="GDScript" id=1]

resource_name = "Game.gd"
script/source = "extends Node

var player_count = 0

func _ready():
	get_tree().connect('network_peer_disconnected', self, '_on_player_disconnected')
	get_tree().connect('server_disconnected', self, '_on_server_disconnected')
	
	var new_player = preload('res://Object/PlayerTank.tscn').instance()
	new_player.name = str(get_tree().get_network_unique_id())
	new_player.set_network_master(get_tree().get_network_unique_id())
	add_child(new_player)
	var info = Network.self_data
	new_player.init(info.name, info.position, false)
	
	update_player_count()
	pass

func update_player_count():
	if player_count != Network.players.size():
		player_count = Network.players.size()
		$CanvasLayer/PlayerCount/Count.text = str(Network.players.size())
	pass

func _process(delta):
	update_player_count()
	pass

func _on_player_disconnected(id):
	get_node(str(id)).queue_free()

func _on_server_disconnected():
	get_tree().change_scene('res://Scenes/LobbyScene.tscn')"
_sections_unfolded = [ "Resource" ]

[node name="TestScene" type="Node"]

script = SubResource( 1 )

[node name="Sprite" type="Sprite" parent="." index="0"]

position = Vector2( 389.403, 238.032 )
texture = ExtResource( 1 )

[node name="CanvasLayer" type="CanvasLayer" parent="." index="1"]

layer = 1
offset = Vector2( 0, 0 )
rotation = 0.0
scale = Vector2( 1, 1 )
transform = Transform2D( 1, 0, 0, 1, 0, 0 )

[node name="PlayerCount" type="Label" parent="CanvasLayer" index="0"]

anchor_left = 0.0
anchor_top = 0.0
anchor_right = 0.0
anchor_bottom = 0.0
margin_right = 40.0
margin_bottom = 14.0
rect_pivot_offset = Vector2( 0, 0 )
rect_clip_content = false
mouse_filter = 2
mouse_default_cursor_shape = 0
size_flags_horizontal = 1
size_flags_vertical = 4
text = "PLAYERS"
align = 1
percent_visible = 1.0
lines_skipped = 0
max_lines_visible = -1

[node name="Count" type="Label" parent="CanvasLayer/PlayerCount" index="0"]

anchor_left = 0.5
anchor_top = 1.0
anchor_right = 0.5
anchor_bottom = 1.0
margin_left = -23.5
margin_top = 6.0
margin_right = 26.5
margin_bottom = 20.0
rect_pivot_offset = Vector2( 0, 0 )
rect_clip_content = false
mouse_filter = 2
mouse_default_cursor_shape = 0
size_flags_horizontal = 1
size_flags_vertical = 4
text = "1"
align = 1
percent_visible = 1.0
lines_skipped = 0
max_lines_visible = -1


